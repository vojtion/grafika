<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kurz grafického designu – přehled</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#fff;--fg:#0f172a;--muted:#475569;--accent-orange:#de7a5f;--accent-blue:#2a5a92;--card:#fff;--shadow:0 14px 40px rgba(15,23,42,.1);--radius:18px}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:'Lexend',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}
    a{color:var(--accent-blue);text-decoration:none}a:hover{text-decoration:underline}
    header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.85);border-bottom:1px solid rgba(15,23,42,.06);backdrop-filter:saturate(180%) blur(12px)}
    .container{max-width:1140px;margin:0 auto;padding:16px 20px}
    .header-inner{display:grid;grid-template-columns:auto 1fr auto;gap:16px;align-items:center}
    .brand{display:flex;align-items:center;gap:14px}
    .brand img{height:40px;width:auto;border-radius:10px;box-shadow:0 2px 8px rgba(15,23,42,.1)}
    .brand h1{font-size:22px;margin:0;font-weight:600;letter-spacing:.2px}
    .segmented{position:relative;display:inline-flex;gap:8px;padding:6px;border-radius:14px;background:#f1f5f9;box-shadow:inset 0 0 0 1px rgba(15,23,42,.06)}
    .segmented .thumb{position:absolute;top:6px;left:6px;height:44px;width:160px;border-radius:12px;background:linear-gradient(180deg,#2a5a92,#244f80);box-shadow:0 10px 24px rgba(42,90,146,.35),inset 0 1px 0 rgba(255,255,255,.35);transition:transform .28s ease,width .28s ease;will-change:transform,width}
    .segmented button{position:relative;z-index:1;min-width:160px;height:44px;padding:0 16px;border:0;background:transparent;border-radius:12px;cursor:pointer;font-weight:600;font-size:14px;color:var(--muted);transition:color .2s ease}
    .segmented button.active{color:#fff}
    .searchbar{margin-top:12px;display:flex;gap:10px;align-items:center}
    .searchbar input{flex:1;padding:14px 16px;border-radius:14px;border:1px solid rgba(15,23,42,.08);background:#f8fafc;outline:none;font-size:14px;box-shadow:inset 0 1px 0 rgba(255,255,255,.8)}
    .filters{margin:14px 0;display:flex;justify-content:center}
    .sw-toggle{display:inline-flex;gap:2px;padding:4px;border-radius:999px;background:#f9fafb;box-shadow:inset 0 0 0 1px rgba(15,23,42,.04)}
    .sw-toggle button{border:0;background:transparent;padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:600;font-size:12px;color:var(--muted);transition:background .2s ease,color .2s ease}
    .sw-toggle button.active{background:rgba(15,23,42,.06);color:var(--fg)}
    main .grid{max-width:1140px;margin:28px auto;padding:0 20px;display:grid;grid-template-columns:repeat(12,1fr);gap:22px}
    @media(max-width:960px){main .grid{grid-template-columns:repeat(6,1fr)}}
    @media(max-width:640px){main .grid{grid-template-columns:repeat(2,1fr)}}
    .card{grid-column:span 4;background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;border:1px solid rgba(15,23,42,.05);transition:transform .24s ease,box-shadow .24s ease}
    .card:hover{transform:translateY(-4px);box-shadow:0 18px 44px rgba(15,23,42,.18)}
    .thumb{position:relative;background:linear-gradient(180deg,#e2e8f0,#f8fafc)}
    .thumb .media{width:100%;aspect-ratio:16/9;display:block;object-fit:cover;background:transparent}
    .badge{position:absolute;top:12px;left:12px;background:var(--accent-blue);color:#fff;padding:7px 12px;border-radius:999px;font-size:12px;font-weight:700;letter-spacing:.2px;box-shadow:0 10px 24px rgba(42,90,146,.3)}
    .appchip{position:absolute;right:12px;bottom:12px;height:30px;min-width:30px;padding:0 8px;border-radius:8px;display:inline-flex;align-items:center;gap:6px;color:#fff;font-weight:700;font-size:12px;letter-spacing:.3px;box-shadow:0 8px 18px rgba(0,0,0,.18)}
    .app-ps{background:#001e36}.app-ai{background:#330000}.app-id{background:#5c1138}
    .content{padding:16px 16px 18px}
    .content h3{margin:6px 0 8px;font-size:18px;letter-spacing:.2px}
    .content .desc{color:var(--muted);font-size:13px;min-height:2.6em}
    .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
    .btn{display:inline-flex;gap:8px;align-items:center;justify-content:center;height:36px;padding:0 14px;border:1px solid rgba(15,23,42,.08);border-radius:10px;background:#fff;font-weight:700;font-size:13px;cursor:pointer;transition:transform .18s ease,box-shadow .18s ease}
    .btn:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(15,23,42,.12)}
    .btn.primary{background:var(--accent-blue);color:#fff;border-color:transparent}
    .btn.orange{background:var(--accent-orange);color:#fff;border-color:transparent}
    .mat-card{grid-column:span 3;border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);border:1px solid rgba(15,23,42,.05);transition:transform .25s ease,box-shadow .25s ease;min-height:110px;color:#fff}
    .mat-card:hover{transform:translateY(-4px);box-shadow:0 18px 44px rgba(15,23,42,.22)}
    .mat-title{font-weight:800;margin:0 0 6px;font-size:16px;line-height:1.2}
    .mat-desc{font-size:13px;opacity:.95;margin-bottom:10px}
    .mat-open{color:#fff;text-decoration:underline;font-weight:700}
    .overlay{position:fixed;inset:0;background:rgba(15,23,42,.35);opacity:0;pointer-events:none;transition:opacity .25s ease;z-index:60}
    .overlay.show{opacity:1;pointer-events:auto}
    .drawer{position:fixed;top:0;right:0;width:420px;max-width:100%;height:100%;background:var(--bg);border-left:1px solid rgba(15,23,42,.08);box-shadow:-24px 0 64px rgba(15,23,42,.2);transform:translateX(100%);transition:transform .28s ease;z-index:70;display:flex;flex-direction:column}
    .drawer.open{transform:translateX(0%)}
    .drawer header{padding:16px 18px;border-bottom:1px solid rgba(15,23,42,.06);display:flex;align-items:center;justify-content:space-between}
    .drawer .list{padding:12px 18px;display:grid;gap:12px;overflow:auto}
    .drawer .item{border:1px solid rgba(15,23,42,.08);border-radius:12px;padding:12px;display:grid;gap:6px;background:#fff}
    footer .container{padding-top:12px;padding-bottom:28px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <header>
    <div class="container header-inner">
      <div class="brand">
        <img src="logo-stepit.png" onerror="this.onerror=null;this.src='logo-stepit.svg'" alt="Step IT logo">
        <h1>Kurz grafického designu</h1>
      </div>
      <div></div>
      <div class="segmented" id="segmented"><div class="thumb" id="thumb"></div><button data-tab="lessons" class="active">Lekce</button><button data-tab="materials">Materiály</button></div>
    </div>
    <div class="container">
      <div class="searchbar"><input id="search" type="search" placeholder="Hledat podle názvu, tématu, softwaru…"></div>
      <div class="filters"><div class="sw-toggle" id="swToggle"><button data-sw="ALL" class="active">Vše</button><button data-sw="PS">Photoshop</button><button data-sw="AI">Illustrator</button><button data-sw="ID">InDesign</button></div></div>
    </div>
  </header>

  <main>
    <div class="container" id="materialsScopeBar" style="display:none;padding:8px 20px 0"><div id="materialsScopeMsg" style="font-size:13px;color:var(--muted)"></div></div>
    <div class="grid" id="grid"></div>
  </main>

  <div class="overlay" id="overlay"></div>
  <aside class="drawer" id="drawer" aria-hidden="true" role="dialog" aria-label="Materiály">
    <header><h3 id="drawerTitle">Materiály</h3><button class="close" id="drawerClose" aria-label="Zavřít">×</button></header>
    <div class="list" id="drawerList"></div>
    <footer style="padding:14px 18px;border-top:1px solid rgba(15,23,42,.06)"><button class="btn primary" id="showAllBtn">Zobrazit všechny</button></footer>
  </aside>

  <footer><div class="container">Vytvořil <a href="https://vojtechmach.com" target="_blank" rel="noopener">Vojtěch Mach</a> pro studenty kurzu grafického designu Step IT ❤️</div></footer>

  <script>
  "use strict";(function(d){
    const $=(s,r=d)=>r.querySelector(s), $$=(s,r=d)=>[...r.querySelectorAll(s)];
    const SW_TINT={PS:'#0b3059',AI:'#5a2a00',ID:'#6d1644'};

    function showDataError(msg){
      const grid=$('#grid');
      grid.innerHTML =
        `<div style="grid-column:1 / -1;padding:14px;border:1px solid rgba(220,38,38,.25);
                     background:rgba(220,38,38,.06);border-radius:12px;color:#7f1d1d;font-size:14px">
           <strong>Nelze načíst data:</strong> ${msg}.
           Zkontroluj, že <code>./data.json</code> leží ve stejné složce jako <code>index.html</code>
           a na hostingu vrací <strong>200 OK</strong> (DevTools → Network).
         </div>`;
    }

    const normSW=v=>{v=(v||'').toUpperCase();return v.includes('PS')?'PS':v.includes('AI')?'AI':v.includes('ID')?'ID':(v||'PS')};
    const split=v=>!v?[]:String(v).split(/[\\r\\n,;]+/).map(s=>s.trim()).filter(Boolean);
    const isDriveFolder=u=>/drive\\.google\\.com\\/.*(?:folders)/i.test(u||'');
    const prettyFromURL=u=>{try{const url=new URL(u),host=url.hostname.replace('www.','');const bits=url.pathname.split('/').filter(Boolean);const last=decodeURIComponent(bits.at(-1)||'');if(/drive\\.google\\.com$/i.test(host)){if(/\\/open$/i.test(url.pathname)||/\\/file\\//i.test(url.pathname))return 'Materiál'} if(last&&/\\.[A-Za-z0-9]{2,5}$/.test(last))return last; if(last&&!/^open$/i.test(last))return last; return host||'Materiál'}catch{return 'Materiál'}};
    const normalizeTok=tok=>{if(!tok)return null; if(typeof tok==='object'&&tok.url){const label=tok.label&&!/^(open|otevřít)$/i.test(tok.label)?tok.label:prettyFromURL(tok.url);return {label,url:tok.url}} const s=String(tok),i=s.indexOf('|'); if(i>0){const lab=s.slice(0,i).trim(),url=s.slice(i+1).trim();return {label:lab||prettyFromURL(url),url}} if(/^https?:\\/\\//i.test(s))return {label:prettyFromURL(s),url:s}; return null};

    const slug=s=>(s||'').normalize('NFD').replace(/[\\u0300-\\u036f]/g,'').replace(/[^a-z0-9]+/gi,'-').replace(/^-+|-+$/g,'').toLowerCase();
    const lessonNo=(ls,arr)=>{if(Number.isFinite(ls.id))return ls.id; if(typeof ls.id==='string'){const m=ls.id.match(/^(\\d{1,3})/); if(m) return +m[1]} return arr.indexOf(ls)+1};

    const candidateImages=(ls,n)=>{const s=slug(ls.title),exts=['.jpg','.jpeg','.png','.webp','.gif']; let arr=[]; if(ls.image)arr.push(ls.image);
      exts.forEach(e=>arr.push(`images/lesson-${n}${e}`,`images/${s}${e}`));
      if(/semestr/i.test(ls.title)){const m=ls.title.match(/(\\d+)/); const sp=m?String(m[1]):''; const variants=[`sp-${sp}`,`SP-${sp}`,`SP${sp}-100`,`sp${sp}-100`,`SP${sp}-101`,`sp${sp}-101`]; variants.forEach(v=>exts.forEach(e=>arr.push(`images/${v}${e}`)))} return [...new Set(arr)]};
    const setFallbackImage=(img,cands)=>{let i=0; const next=()=>{if(i>=cands.length){img.style.display='none';return} img.src=cands[i++]}; img.addEventListener('error',next); next()};

    let DATA={lessons:[]}, LESSONS=[], PROJECTS=[], ALL_MATS=[], tab='lessons', sw='ALL', scope=null;

    async function load(){
      try{
        const res=await fetch('./data.json',{cache:'no-store'});
        if(!res.ok){
          showDataError(`HTTP status ${res.status} při načítání ./data.json`);
          DATA={lessons:[]};
        }else{
          const j=await res.json();
          if(!j || !Array.isArray(j.lessons)){
            showDataError('soubor ./data.json nemá očekávaný tvar (chybí pole lessons)');
            DATA={lessons:[]};
          }else{
            DATA=j;
          }
        }
      }catch(e){
        showDataError('výjimka při fetchi ./data.json ('+(e&&e.message||e)+')');
        DATA={lessons:[]};
      }
      normalize(DATA);
    }

    function normalize(data){
      const keepLesson=ls=>{const t=(ls.title||'').toString().trim().toLowerCase(); const isBadTitle=!t||['none','null','nan','non'].includes(t); const hasContent=(ls.blocks&&ls.blocks.length)||(ls.presentations&&ls.presentations.length)||(ls.materials&&ls.materials.length); return !isBadTitle||hasContent;};
      data.lessons=(data.lessons||[]).map(ls=>({
        id:ls.id,title:ls.title||'',blocks:ls.blocks||[],software:normSW(ls.software||ls.SW||''),image:ls.image||'',
        presentations:Array.isArray(ls.presentation)?ls.presentation.map(normalizeTok).filter(Boolean):split(ls.presentation).map(normalizeTok),
        materials:(ls.materials||[]).map(normalizeTok).filter(Boolean),
        extraMaterials:(ls.extraMaterials||[]).map(normalizeTok).filter(Boolean)
      })).filter(keepLesson);
      buildGroups(); buildMaterials(); render();
    }

    function buildGroups(){LESSONS=[]; PROJECTS=[]; (DATA.lessons||[]).forEach(ls=> (/semestr/i.test(ls.title)?PROJECTS:LESSONS).push(ls));}
    function buildMaterials(){
      ALL_MATS=[];(DATA.lessons||[]).forEach(ls=>{
        const push=it=>it&&ALL_MATS.push({url:it.url,label:it.label||prettyFromURL(it.url),lessonId:lessonNo(ls,DATA.lessons),lessonTitle:ls.title,software:ls.software,blocks:ls.blocks,isFolder:isDriveFolder(it.url)});
        (ls.materials||[]).forEach(push); (ls.extraMaterials||[]).forEach(push);
      });
    }

    const logoSW=l=>{const colors={PS:'#001e36',AI:'#330000',ID:'#5c1138'},fg={PS:'#30a8ff',AI:'#ff9a00',ID:'#ff5bf1'},t=l==='AI'?'Ai':l==='ID'?'Id':'Ps';
      return `<svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><rect rx="4" width="24" height="24" fill="${colors[l]||'#001e36'}"></rect><text x="12" y="16" text-anchor="middle" font-size="12" fill="${fg[l]||fg.PS}" font-family="Lexend, Arial" font-weight="800">${t}</text></svg>`};
    const appChip=sw=>`<div class="appchip ${sw==='AI'?'app-ai':sw==='ID'?'app-id':'app-ps'}">${logoSW(sw)}<span>${sw}</span></div>`;
    const projectChip=()=>`<div class="appchip" style="background:#6b21a8">
      <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M10 6h4l1 2h4a1 1 0 0 1 1 1v9a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9a1 1 0 0 1 1-1h4l1-2z" fill="#fff" opacity=".25"/>
        <path d="M9 10h6v2H9z" fill="#fff"/>
      </svg><span>SP</span></div>`;

    function lessonCard(ls){
      const el=d.createElement('div'); el.className='card'; const n=lessonNo(ls,DATA.lessons); const isProject=/semestr/i.test(ls.title);
      el.innerHTML=`<div class='thumb'><img class='media' alt='' loading='lazy'><div class='badge'>Lekce ${n}</div>${isProject?projectChip():appChip(ls.software)}</div>
        <div class='content'><h3>${ls.title||('Lekce '+n)}</h3><div class='desc'>${(ls.blocks||[]).join(' • ')}</div><div class='actions' data-actions></div></div>`;
      setFallbackImage($('.media',el),candidateImages(ls,n));
      const act=$('[data-actions]',el);
      (ls.presentations||[]).forEach(p=>{const a=d.createElement('a'); a.className='btn primary'; a.href=p.url; a.target='_blank'; a.rel='noopener'; a.textContent='Prezentace'; act.appendChild(a)});
      const any=(ls.materials?.length||0)+(ls.extraMaterials?.length||0)>0; const b=d.createElement('button');
      b.className='btn orange'; b.textContent='Učební materiály'; b.disabled=!any; b.addEventListener('click',()=>openDrawer(ls)); act.appendChild(b);
      return el;
    }

    const materialCard=i=>{const el=d.createElement('div'); el.className='mat-card'; el.style.background=SW_TINT[i.software]||'#7a4d3a';
      el.innerHTML=`<h4 class='mat-title'>${i.label}</h4><div class='mat-desc'>${(i.blocks||[]).join(' • ')||i.lessonTitle||''}</div><a class='mat-open' href='${i.url}' target='_blank' rel='noopener'>Otevřít →</a>`; return el};

    const matches=(ls,q)=>{if(!q)return true; q=q.toLowerCase(); return [ls.title,...(ls.blocks||[]),ls.software].join('||').toLowerCase().includes(q)};
    const bySW=swv=>sw==='ALL'||(swv||'').toUpperCase().includes(sw);

    const overlay=$('#overlay'), drawer=$('#drawer'), list=$('#drawerList'), title=$('#drawerTitle');
    function openDrawer(ls){
      title.textContent=`Materiály – Lekce ${lessonNo(ls,DATA.lessons)}: ${ls.title}`; list.innerHTML='';
      const items=[...(ls.materials||[]),...(ls.extraMaterials||[])].map(normalizeTok).filter(Boolean);
      if(!items.length){const e=d.createElement('div'); e.className='item'; e.textContent='Žádné materiály'; list.appendChild(e)}
      items.forEach((m,i)=>{const lab=m.label||prettyFromURL(m.url); const e=d.createElement('div'); e.className='item'; e.innerHTML=`<div style="color:var(--muted);font-size:12px">Materiál ${i+1}</div><a href='${m.url}' target='_blank' rel='noopener'>${lab}</a>`; list.appendChild(e)});
      $('#showAllBtn').onclick=()=>{scope={type:'lesson',id:lessonNo(ls,DATA.lessons),title:ls.title}; closeDrawer(); switchTo('materials')};
      overlay.classList.add('show'); drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false');
    }
    function closeDrawer(){overlay.classList.remove('show'); drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true')}
    $('#drawerClose').addEventListener('click',closeDrawer); $('#overlay').addEventListener('click',closeDrawer); d.addEventListener('keydown',e=>{if(e.key==='Escape')closeDrawer()});

    function render(){
      const grid=$('#grid'); grid.innerHTML=''; const q=$('#search').value.trim();
      // split groups every render (in case data changed)
      LESSONS=[]; PROJECTS=[]; (DATA.lessons||[]).forEach(ls=> (/semestr/i.test(ls.title)?PROJECTS:LESSONS).push(ls));
      if(tab==='lessons'){
        $('#materialsScopeBar').style.display='none';
        LESSONS.filter(ls=>matches(ls,q)&&bySW(ls.software)).forEach(ls=>grid.appendChild(lessonCard(ls)));
        if(PROJECTS.length){const sep=d.createElement('div'); sep.style.gridColumn='1 / -1'; sep.innerHTML='<h3 style="margin:4px 0 0;font-size:18px">Semestrální práce</h3>'; grid.appendChild(sep);
          PROJECTS.filter(ls=>matches(ls,q)&&bySW(ls.software)).forEach(ls=>grid.appendChild(lessonCard(ls)))}
      }else{
        const bar=$('#materialsScopeBar'), msg=$('#materialsScopeMsg');
        if(scope){bar.style.display=''; msg.innerHTML=`Zobrazuji materiály pro <strong>Lekci ${scope.id} – ${scope.title}</strong>. <a href="#" id="clearScope">Zrušit filtr</a>`} else bar.style.display='none';
        let mats=ALL_MATS.filter(m=>!m.isFolder);
        if(scope) mats=mats.filter(m=>m.lessonId===scope.id);
        if(sw!=='ALL') mats=mats.filter(m=>(m.software||'').toUpperCase().includes(sw));
        const ql=q.toLowerCase();
        if(ql) mats=mats.filter(m=>(m.label||'').toLowerCase().includes(ql)||(m.lessonTitle||'').toLowerCase().includes(ql)||(m.software||'').toLowerCase().includes(ql));
        mats.forEach(it=>grid.appendChild(materialCard(it)));
        const clear=$('#clearScope'); if(clear) clear.addEventListener('click',e=>{e.preventDefault(); scope=null; render()});
      }
    }

    function moveThumb(idx){const btns=$$('.segmented button'); btns.forEach((b,i)=>b.classList.toggle('active',i===idx)); const cur=btns[idx],thumb=$('#thumb'); thumb.style.width=cur.getBoundingClientRect().width+'px'; thumb.style.transform=`translateX(${cur.offsetLeft-btns[0].offsetLeft}px)`}
    const switchTo=t=>{tab=t; moveThumb(t==='lessons'?0:1); render(); d.querySelector('main').scrollIntoView({behavior:'smooth',block:'start'})}

    (async function init(){
      await load();
      $('#segmented').addEventListener('click',e=>{const b=e.target.closest('button[data-tab]'); if(!b)return; if(b.dataset.tab!=='materials') scope=null; switchTo(b.dataset.tab)});
      moveThumb(0);
      $('#swToggle').addEventListener('click',e=>{const b=e.target.closest('button[data-sw]'); if(!b)return; $$('#swToggle button').forEach(x=>x.classList.remove('active')); b.classList.add('active'); sw=b.dataset.sw; render()});
      $('#search').addEventListener('input',render);
      // prepare materials index
      ALL_MATS=[];(DATA.lessons||[]).forEach(ls=>{
        const push=it=>it&&ALL_MATS.push({url:it.url,label:it.label||prettyFromURL(it.url),lessonId:lessonNo(ls,DATA.lessons),lessonTitle:ls.title,software:ls.software,blocks:ls.blocks,isFolder:isDriveFolder(it.url)});
        (ls.materials||[]).forEach(push); (ls.extraMaterials||[]).forEach(push);
      });
      render();
    })();
  })(document);
  </script>
</body>
</html>
